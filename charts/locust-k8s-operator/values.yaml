# =============================================================================
# Locust K8s Operator - Go v2.0.0
# =============================================================================

# -- Operator image configuration
image:
  repository: lotest/locust-k8s-operator
  tag: ""  # Defaults to appVersion
  pullPolicy: IfNotPresent
  pullSecrets: []

# -- Operator pod resources (Go binary is lightweight)
resources:
  limits:
    cpu: 500m
    memory: 128Mi
  requests:
    cpu: 10m
    memory: 64Mi

# -- Replica count (use with leader election for HA)
replicaCount: 2

# -- Leader election for HA deployments
leaderElection:
  enabled: true

# -- Metrics endpoint (Prometheus)
metrics:
  enabled: false  # Disabled by default, enable if scraping
  port: 8080
  secure: false

# -- Webhook configuration (for validation/conversion)
webhook:
  enabled: false  # Requires cert-manager
  port: 9443
  certManager:
    enabled: true  # Use cert-manager for TLS

# -- CRD installation
crd:
  install: true

# =============================================================================
# Locust Test Pod Configuration (what the operator creates)
# =============================================================================

locustPods:
  # -- Default resources for Locust containers
  resources:
    requests:
      cpu: 250m
      memory: 128Mi
      ephemeralStorage: 30M
    limits:
      cpu: 1000m
      memory: 1024Mi
      ephemeralStorage: 50M

  # -- Inject affinity/tolerations from CR spec
  affinityInjection: true
  tolerationsInjection: true

  # -- Job TTL after completion (empty = Kubernetes default)
  ttlSecondsAfterFinished: ""

  # -- Metrics exporter sidecar (for v1 API / non-OTel mode)
  metricsExporter:
    image: containersol/locust_exporter:v0.5.0
    port: 9646
    pullPolicy: IfNotPresent
    resources:
      requests:
        cpu: 100m
        memory: 64Mi
        ephemeralStorage: 30M
      limits:
        cpu: 250m
        memory: 128Mi
        ephemeralStorage: 50M

# =============================================================================
# Optional: OTel Collector (for v2 API OTel mode)
# =============================================================================

otelCollector:
  enabled: false
  image: otel/opentelemetry-collector-contrib:0.92.0
  replicas: 1
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  # -- OTel Collector configuration (YAML)
  config: |
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    processors:
      batch: {}
    exporters:
      debug:
        verbosity: detailed
    service:
      pipelines:
        metrics:
          receivers: [otlp]
          processors: [batch]
          exporters: [debug]

# =============================================================================
# Standard Kubernetes options
# =============================================================================

serviceAccount:
  create: true
  name: ""
  annotations: {}

podAnnotations: {}
nodeSelector: {}
tolerations: []
affinity: {}

# =============================================================================
# Backward Compatibility (DEPRECATED - use new paths above)
# =============================================================================
# These values are mapped to new paths via _helpers.tpl for existing users.
# They will be removed in a future release.

# config:
#   loadGenerationJobs:
#     ttlSecondsAfterFinished: ""
#   loadGenerationPods:
#     resource:
#       cpuRequest: 250m
#       memRequest: 128Mi
#       cpuLimit: 1000m
#       memLimit: 1024Mi
#     affinity:
#       enableCrInjection: true
#     taintTolerations:
#       enableCrInjection: true
#     metricsExporter:
#       image: "containersol/locust_exporter:v0.5.0"
#       port: 9646
#     kafka:
#       bootstrapServers: localhost:9092
#       acl:
#         enabled: false

# -- Kafka configuration (DEPRECATED - kept for backward compatibility)
kafka:
  enabled: false
  bootstrapServers: localhost:9092
  security:
    enabled: false
    protocol: SASL_PLAINTEXT
    saslMechanism: SCRAM-SHA-512
    jaasConfig: ""
  credentials:
    secretName: ""
    usernameKey: username
    passwordKey: password

# =============================================================================
# K8s RBAC Configuration
# =============================================================================

k8s:
  clusterRole:
    enabled: true
